(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-94821a4a"],{"060a":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABoVBMVEVHcEwA1P8Auf8Htf4ItP8GtP4Aqv8FtPwHtP8GtP0GtP0Ftf8Gtf0FtP0HtP0Gtv0Gtf0Gtf8FtP4Ftf0FtP0GuP8FtPwFtP4Auf8FtP0FtP0GtP0GtP4Gtf4GtP0Gtf4Gs/wGtf8AgP8A//8GtP4A//8Gs/0GtP0GtP0AAP8Atv8Ftf0GtP4Gtf4Fs/0An/8FtP4Gs/wEtv8Gtv8Gtf4Atf8IsvcGtv8GtP4Gtf0GtP0Fs/wGtf4GsvwGtP0Gt/8Gtv8Htf8GtP4GtP0Htf8EtP8GtP4Ftf4Ftf4Atf8GtP8Ftf8Gtf0GtP4GtP0FtP0Gtf8Gtv8FtP0Jtv8GtP0Gtf0Fs/oEtf8GtP4Ftf8FtP0Gtf0Gtf4GtP4FtP4ItP8Gtf4GtP0FtP4GtP0GtPwFtP0HtP8LvP8Amf8Gtf0Itf8ItvsHtv8Es/8Jvf8Htv8Fs/wHtf0Htf8Ftf4GsfkEsvsHtv8Htv8Ftf0Axv8HtP0Gs/0FtPwGtP4Gtv8FtP4AvP8GtfwHtf8FtP8Hs/8Gtv8Gs/wFtP4EtP8Ftf8GtP1fzV70AAAAinRSTlMABhbEIvgMYnD54ZiG6pmEgFbzjpIryMgL9PL8zNj9r1dTAgLNAXmF9wEHl7W58wjoWzt25h8hKueo9cf3VvhYhJXU05s6xenHGFWXfNDd8VpQmByfqTY+sGfv2LD8xUHViLt7XI5LFwWePkJGQBtsYZduvS5CSU2QCZriwa6I8hdZazNNerbqRDQ5RswaAAABoElEQVQ4y4VT5X/CMBB9MApjbdmYAMPGkLm7u7u7u7u7S//qtc1SyuDH3pfc5V5yl5c7QIHezFp4huEtrFmPcOhMiYKCRJPuT1jDGYUQGDmNOq6NEcIQow3GU+KECIhLUc5HjIuM3zs0qvsfXa4CVRZSB6c69A6kqVxOfp+6/tJQglF6rYnY+bESvoE32VgnuyZRv1Ri3iVIKAGK4yVs/yqmhyek8D8pBMEMlprOZBFfgCFJhJPusrBS88NAUQjk010L+DB9bsXCsqjDg6Gmu+jTLRtXwJrCZijh9PJa1PT15d4unAELKgJJsXxwknvz8PwE5JwD+8F8naRI5yKR05F3IYm7uzJPCV3kmRlzypEj+X9GM1zE7YVZWqbHafw4GzsbMqe9zS76PUTqsRKSwn4I7KUK/uFsiWIzdBTYyGc5JifystyzmZvYWnVIzP70gHxNN/3uwaGAzwsUFi/RXK31XtpxpGEGRvoyp2bUirY0+sJbLhTV/zRtUXn0ti+rjD44/oqoo9fQlBNteGuadRHmW+9hrTxTV1Wbm24L7v4A8YdBuTYAYWEAAAAASUVORK5CYII="},"091c":function(t,e,i){"use strict";var r=i("fe8b"),a=i.n(r);a.a},"0a9c":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAARVBMVEUAAAAA//8uydgpytYtytotytcryNgrydgqyNYryNYrydYqyNYqydcrydYqyNYrydcryNYryNY+zdmv6u/K8fTx+/z///9U7VcPAAAAEXRSTlMAASE+Pj9UiYrCwsfY5+v4+aZaVdoAAACkSURBVCjPfZPtEoYQEIWXlIgkcv+X+r7FMGqc84t5xtqzH0RFbJLKOmeVnBi9tBhfZZYO8c132nhj8+5f2ufKDv/RUSiv784Qzvo2R27/hZRC+/fJs8WKKcV2++fMzAgaRsKPoJ9oHUNJegw12ewh3rpSup5DdmTJFQ+9HkcOQxgWJKRIIiuwCLB8sPC4ZbjZcEzwgOHRxEN9r4NY9b0OehV1HX7T2Soly+KilAAAAABJRU5ErkJggg=="},"26ec":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"newCombo"},[i("van-field",{attrs:{clearable:"",required:"",maxlength:"20","input-align":"right",label:"套餐名称"},model:{value:t.pkname,callback:function(e){t.pkname=e},expression:"pkname"}}),t._l(t.listArr,(function(e,r){return i("div",{key:r,staticClass:"newCombo-item"},[1!==t.listArr.length?i("span",{staticClass:"del",on:{click:function(e){return t.del(r)}}},[t._v("删除")]):t._e(),i("van-cell-group",{attrs:{title:"商品"+(r+1)}},[i("van-field",{attrs:{"input-align":"right",maxlength:"20",label:"商品名称",clearable:"",placeholder:"请输入"},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"item.name"}}),i("van-field",{attrs:{"input-align":"right",type:"digit",label:"数量",clearable:"",placeholder:"请输入"},model:{value:e.count,callback:function(i){t.$set(e,"count",i)},expression:"item.count"}}),i("van-field",{attrs:{type:"number","input-align":"right",label:"单价",clearable:"",placeholder:"0"},on:{blur:function(e){return t.formatter(e,r)}},model:{value:e.original_price,callback:function(i){t.$set(e,"original_price",i)},expression:"item.original_price"}}),r===t.listArr.length-1?i("van-field",{staticClass:"field-center",attrs:{disabled:"","input-align":"center"}},[i("div",{staticClass:"addMusic",attrs:{slot:"label"},slot:"label"},[i("img",{attrs:{width:"14",height:"14",src:t.addImg,alt:""}}),i("span",{staticStyle:{"margin-left":"5px"},on:{click:t.add}},[t._v("增加商品")])])]):t._e()],1)],1)})),i("van-cell-group",[i("van-field",{attrs:{disabled:"","input-align":"right",label:"套餐原价(元)",value:t.total}}),i("van-field",{attrs:{required:"",type:"number","label-width":"120","input-align":"right",clearable:"",label:"套餐 优惠价(元)",placeholder:"将计入到开房扫码的价格中"},on:{blur:function(e){return t.actual_priceFormat(e)}},model:{value:t.actual_price,callback:function(e){t.actual_price=e},expression:"actual_price"}})],1),i("van-cell",{staticClass:"usetime",attrs:{required:"",title:"可用时段",value:t.useTime,"is-link":"",to:"comboTime"},on:{click:t.linkTime}}),i("van-cell",{attrs:{required:"",title:"上架状态"}},[i("van-switch",{attrs:{size:"24px"},model:{value:t.upChecked,callback:function(e){t.upChecked=e},expression:"upChecked"}})],1),i("div",{staticStyle:{width:"100%","text-align":"center"}},[i("van-button",{staticClass:"savebtn",attrs:{type:"info"},on:{click:t.save}},[t._v("保存")])],1),i("van-action-sheet",{staticClass:"uppop",attrs:{round:!1,title:""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("div",{staticClass:"uppop-wrapper"},[i("div",{staticClass:"top"},[i("van-button",{attrs:{type:"default"}},[t._v("取消")]),i("van-button",{attrs:{type:"default"}},[t._v("确定")])],1)])]),i("van-overlay",{attrs:{show:t.overlay}},[i("div",{staticClass:"overlay"},[i("van-loading")],1)])],2)},a=[],s=i("8f8b"),n={name:"",data(){return{comboPart:"",comboInfo:"",timeObj:null,quaryStart:0,quaryEnd:0,quaryDay:[],week:[{label:"周一",id:"mon",index:1},{label:"周二",id:"tues",index:2},{label:"周三",id:"wed",index:3},{label:"周四",id:"thur",index:4},{label:"周五",id:"fri",index:5},{label:"周六",id:"sat",index:6},{label:"周日",id:"sun",index:7}],overlay:!1,pkname:"优选套餐",show:!1,actual_price:"",upChecked:!0,actions:[{name:"选项",color:"#07c160"},{loading:!0},{name:"禁用选项",disabled:!0}],signChecked:!1,listArr:[{name:"",count:"",original_price:0}],listImg:i("060a"),addImg:i("0a9c")}},created(){this.initData()},computed:{addNewComboItem(){return this.$store.state.combo.addNewComboItem},useTime(){return this.timeObj?this.timeObj.label:`${this.currentWeek}${this.currentWeek?"；":""}${0===this.currentTime?"":this.currentTime+"-"+this.currentEndTime}`},total(){let t=0;for(let e=0;e<this.listArr.length;e++){const i=this.listArr[e];t+=Number(i.count)*Number(i.original_price||0)}return t.toFixed(2)},period_weekdays(){return this.$route.query.period_weekdays||[]},period_time_start(){return this.$route.query.period_time_start||0},period_time_end(){return this.$route.query.period_time_end||0},currentTime(){return this.$route.query.currentTime||0},currentEndTime(){return this.$route.query.currentEndTime||0},currentWeek(){return this.$route.query.currentWeek?this.$route.query.currentWeek.join("、"):""}},methods:{initData(){this.$route.query.pk&&(this.$store.commit("set_addNewComboItem",null),Object(s["c"])(this.$store.state.user.ktv_id,this.$store.state.combo.comboItem.id).then(t=>{if(t.status<400){let i=t.data;this.pkname=i.name,this.listArr=i.goods,this.upChecked=i.enabled,this.quaryDay=i.period_weekdays;var e=["周一","周二","周三","周四","周五","周六","周日"];let r=[];i.period_weekdays.forEach(t=>{this.week.forEach(e=>{e.id===t&&r.push(e.label)})}),r.sort((function(t,i){var r=e.indexOf(t),a=e.indexOf(i);return r-a}));let a=r.join("，");this.timeObj={label:a+" "+this.changeTime(i.period_time_start)+" - "+this.changeTime(i.period_time_end)},this.quaryStart=i.period_time_start||0,this.quaryEnd=i.period_time_end,this.actual_price=i.actual_price}}));let t=this.addNewComboItem;if(t){if(this.pkname=t.name,this.actual_price=t.actual_price,this.upChecked=t.enabled,0===t.goods.length)return void(this.listArr=[{name:"",count:"",original_price:0}]);this.listArr=t.goods}},modiComboItem(){this.overlay=!0;let t=this.listArr.filter((function(t){return t.original_price=parseFloat(t.original_price),t})),e={name:this.pkname,goods:this.listArr[0].name?t:[],period_weekdays:this.period_weekdays,period_time_start:this.period_time_start,period_time_end:this.period_time_end,enabled:this.upChecked,actual_price:this.actual_price};Object(s["f"])({ktv_id:this.$store.state.user.ktv_id,pk:this.$route.query.pk},e).then(t=>{this.overlay=!1,(200===t.status||t.status<400)&&(this.$toast({message:"套餐修改成功",type:"success"}),this.$router.push({name:"roomPackage"}))})},addCombo(){this.overlay=!0;let t=this.listArr.filter((function(t){return t.original_price=parseFloat(t.original_price),t})),e={name:this.pkname,goods:this.listArr[0].name?t:[],period_weekdays:this.period_weekdays,period_time_start:this.period_time_start,period_time_end:this.period_time_end,enabled:this.upChecked,actual_price:this.actual_price};Object(s["a"])(this.$store.state.user.ktv_id,e).then(t=>{this.overlay=!1,(200===t.status||t.status<400)&&(this.$toast({message:"套餐新增成功",type:"success"}),this.$router.push({name:"roomPackage"}))})},actual_priceFormat(t){if(!t.target.value)return void(this.actual_price="");let e=0;"number"===typeof Number(t.target.value)&&(e=Number(t.target.value).toFixed(2)),this.actual_price=e},formatter(t,e){let i=0;"0"!==t.target.value.substring(0,1)&&0!==Number(t.target.value)?(i="number"===typeof Number(t.target.value)?Number(t.target.value).toFixed(2):0,this.listArr[e].original_price=i):this.listArr[e].original_price=0},onCancel(){this.show=!1},del(t){this.listArr.splice(t,1)},changeTime(t){let e="",i="",r=Math.floor(t/60),a=Math.floor(t%60);return e=r<10?`0${r}`:r,i=a<10?`0${a}`:a,`${e}:${i}`},linkTime(){let t=this.listArr.filter((function(t){return t.original_price=parseFloat(t.original_price),t})),e={name:this.pkname,goods:this.listArr[0].name?t:[],enabled:this.upChecked,actual_price:this.actual_price,currentTime:this.$route.query.currentTime||this.quaryStart,currentEndTime:this.$route.query.currentEndTime||this.quaryEnd,pk:this.$route.query.pk||null,period_weekdays:this.$route.query.period_weekdays||this.quaryDay||[]};this.$store.commit("set_addNewComboItem",e)},generationObj(){return{name:"",count:"",original_price:""}},add(){this.listArr.push(this.generationObj())},save(){let t=!0;if(this.pkname){if(this.listArr.length>1){for(let e=0;e<this.listArr.length;e++){const i=this.listArr[e];if(!i.name||!i.count||!i.original_price){this.toast("商品信息请输入完整"),t=!1;break}}if(!t)return}if(1===this.listArr.length){let t=this.listArr[0];if(t.name&&!t.count||t.name&&!t.original_price||t.count&&!t.name||t.count&&!t.original_price||t.original_price&&!t.name||t.original_price&&!t.count)return void this.toast("商品信息请输入完整")}""!==this.actual_price?0!=this.actual_price?this.useTime?this.$route.query.pk?this.modiComboItem():this.addCombo():this.toast("请选择可用时段"):this.toast("套餐优惠价不可为0"):this.toast("请输入套餐优惠价")}else this.toast("套餐名称不可为空")},toast(t){this.$toast.fail({duration:2500,forbidClick:!0,overlay:!0,className:"loadClass",message:t})}},mounted(){}},l=n,o=(i("091c"),i("8279"),i("2877")),u=Object(o["a"])(l,r,a,!1,null,"10509250",null);e["default"]=u.exports},"308c":function(t,e,i){},8279:function(t,e,i){"use strict";var r=i("308c"),a=i.n(r);a.a},"8f8b":function(t,e,i){"use strict";i.d(e,"d",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return l})),i.d(e,"f",(function(){return o})),i.d(e,"e",(function(){return u}));var r=i("66df");const a=t=>r["a"].request({url:`/ktv/pkg/ktvs/${t}/packages`,params:{is_delete:!1,ordering:"-weight"},method:"get"}),s=(t,e)=>r["a"].request({url:`/ktv/pkg/ktvs/${t}/packages/${e}`,params:{},method:"get"}),n=(t,e)=>r["a"].request({url:`/ktv/pkg/ktvs/${t}/packages`,data:e,method:"post"}),l=(t,e)=>r["a"].request({url:`/ktv/pkg/ktvs/${t}/packages/${e}`,method:"delete"}),o=(t,e)=>r["a"].request({url:`/ktv/pkg/ktvs/${t.ktv_id}/packages/${t.pk}`,method:"put",data:e}),u=(t,e)=>r["a"].request({url:`/ktv/pkg/ktvs/${t.ktv_id}/packages/batch_manage`,method:"put",data:{package_opts:e}})},fe8b:function(t,e,i){}}]);
//# sourceMappingURL=chunk-94821a4a.6138c0f8.js.map