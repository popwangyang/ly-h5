(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5bf95cd9"],{"060a":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABoVBMVEVHcEwA1P8Auf8Htf4ItP8GtP4Aqv8FtPwHtP8GtP0GtP0Ftf8Gtf0FtP0HtP0Gtv0Gtf0Gtf8FtP4Ftf0FtP0GuP8FtPwFtP4Auf8FtP0FtP0GtP0GtP4Gtf4GtP0Gtf4Gs/wGtf8AgP8A//8GtP4A//8Gs/0GtP0GtP0AAP8Atv8Ftf0GtP4Gtf4Fs/0An/8FtP4Gs/wEtv8Gtv8Gtf4Atf8IsvcGtv8GtP4Gtf0GtP0Fs/wGtf4GsvwGtP0Gt/8Gtv8Htf8GtP4GtP0Htf8EtP8GtP4Ftf4Ftf4Atf8GtP8Ftf8Gtf0GtP4GtP0FtP0Gtf8Gtv8FtP0Jtv8GtP0Gtf0Fs/oEtf8GtP4Ftf8FtP0Gtf0Gtf4GtP4FtP4ItP8Gtf4GtP0FtP4GtP0GtPwFtP0HtP8LvP8Amf8Gtf0Itf8ItvsHtv8Es/8Jvf8Htv8Fs/wHtf0Htf8Ftf4GsfkEsvsHtv8Htv8Ftf0Axv8HtP0Gs/0FtPwGtP4Gtv8FtP4AvP8GtfwHtf8FtP8Hs/8Gtv8Gs/wFtP4EtP8Ftf8GtP1fzV70AAAAinRSTlMABhbEIvgMYnD54ZiG6pmEgFbzjpIryMgL9PL8zNj9r1dTAgLNAXmF9wEHl7W58wjoWzt25h8hKueo9cf3VvhYhJXU05s6xenHGFWXfNDd8VpQmByfqTY+sGfv2LD8xUHViLt7XI5LFwWePkJGQBtsYZduvS5CSU2QCZriwa6I8hdZazNNerbqRDQ5RswaAAABoElEQVQ4y4VT5X/CMBB9MApjbdmYAMPGkLm7u7u7u7u7S//qtc1SyuDH3pfc5V5yl5c7QIHezFp4huEtrFmPcOhMiYKCRJPuT1jDGYUQGDmNOq6NEcIQow3GU+KECIhLUc5HjIuM3zs0qvsfXa4CVRZSB6c69A6kqVxOfp+6/tJQglF6rYnY+bESvoE32VgnuyZRv1Ri3iVIKAGK4yVs/yqmhyek8D8pBMEMlprOZBFfgCFJhJPusrBS88NAUQjk010L+DB9bsXCsqjDg6Gmu+jTLRtXwJrCZijh9PJa1PT15d4unAELKgJJsXxwknvz8PwE5JwD+8F8naRI5yKR05F3IYm7uzJPCV3kmRlzypEj+X9GM1zE7YVZWqbHafw4GzsbMqe9zS76PUTqsRKSwn4I7KUK/uFsiWIzdBTYyGc5JifystyzmZvYWnVIzP70gHxNN/3uwaGAzwsUFi/RXK31XtpxpGEGRvoyp2bUirY0+sJbLhTV/zRtUXn0ti+rjD44/oqoo9fQlBNteGuadRHmW+9hrTxTV1Wbm24L7v4A8YdBuTYAYWEAAAAASUVORK5CYII="},"0a9c":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAARVBMVEUAAAAA//8uydgpytYtytotytcryNgrydgqyNYryNYrydYqyNYqydcrydYqyNYrydcryNYryNY+zdmv6u/K8fTx+/z///9U7VcPAAAAEXRSTlMAASE+Pj9UiYrCwsfY5+v4+aZaVdoAAACkSURBVCjPfZPtEoYQEIWXlIgkcv+X+r7FMGqc84t5xtqzH0RFbJLKOmeVnBi9tBhfZZYO8c132nhj8+5f2ufKDv/RUSiv784Qzvo2R27/hZRC+/fJs8WKKcV2++fMzAgaRsKPoJ9oHUNJegw12ewh3rpSup5DdmTJFQ+9HkcOQxgWJKRIIiuwCLB8sPC4ZbjZcEzwgOHRxEN9r4NY9b0OehV1HX7T2Soly+KilAAAAABJRU5ErkJggg=="},1427:function(t,e,a){t.exports=a.p+"img/empty.d72b6a74.png"},"1b12":function(t,e,a){"use strict";var i=a("fc28"),s=a.n(i);s.a},"1fe8":function(t,e,a){t.exports=a.p+"img/error.9a7c2d33.png"},"26ec":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"scroll"},[a("ContentLoad",{staticClass:"newCombo",attrs:{getInfo:t.getDetail}},[a("van-field",{attrs:{clearable:"",required:"",maxlength:"20","input-align":"right",label:"套餐名称"},model:{value:t.pkname,callback:function(e){t.pkname=e},expression:"pkname"}}),t._l(t.listArr,(function(e,i){return a("div",{key:i,staticClass:"newCombo-item"},[1!==t.listArr.length?a("span",{staticClass:"del",on:{click:function(e){return t.del(i)}}},[t._v("删除")]):t._e(),a("van-cell-group",{attrs:{title:"商品"+(i+1)}},[a("van-field",{attrs:{"input-align":"right",maxlength:"20",label:"商品名称",clearable:"",placeholder:"请输入"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"item.name"}}),a("van-field",{attrs:{"input-align":"right",type:"digit",label:"数量",clearable:"",placeholder:"请输入"},model:{value:e.count,callback:function(a){t.$set(e,"count",a)},expression:"item.count"}}),a("van-field",{attrs:{type:"number","input-align":"right",label:"单价",clearable:"",placeholder:"0"},on:{blur:function(e){return t.formatter(e,i)}},model:{value:e.original_price,callback:function(a){t.$set(e,"original_price",a)},expression:"item.original_price"}}),i===t.listArr.length-1?a("van-field",{staticClass:"field-center",attrs:{disabled:"","input-align":"center"}},[a("div",{staticClass:"addMusic",attrs:{slot:"label"},slot:"label"},[a("img",{attrs:{width:"14",height:"14",src:t.addImg,alt:""}}),a("span",{staticStyle:{"margin-left":"5px"},on:{click:t.add}},[t._v("增加商品")])])]):t._e()],1)],1)})),a("van-cell-group",[a("van-field",{attrs:{disabled:"","input-align":"right",label:"套餐原价(元)",value:t.total}}),a("van-field",{attrs:{required:"",type:"number","label-width":"120","input-align":"right",clearable:"",label:"套餐 优惠价(元)",placeholder:"将计入到开房扫码的价格中"},on:{blur:function(e){return t.actual_priceFormat(e)}},model:{value:t.actual_price,callback:function(e){t.actual_price=e},expression:"actual_price"}})],1),a("van-cell",{staticClass:"usetime",attrs:{required:"",title:"可用时段",value:t.timeStr,"is-link":"",to:{path:"comboTime",query:{c:this.$route.query.c}}}}),a("van-cell",{attrs:{required:"",title:"上架状态"}},[a("van-switch",{attrs:{size:"24px"},model:{value:t.upChecked,callback:function(e){t.upChecked=e},expression:"upChecked"}})],1),a("div",{staticStyle:{width:"100%","text-align":"center"}},[a("van-button",{staticClass:"savebtn",attrs:{type:"info"},on:{click:t.save}},[t._v("保存")])],1),a("van-action-sheet",{staticClass:"uppop",attrs:{round:!1,title:""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("div",{staticClass:"uppop-wrapper"},[a("div",{staticClass:"top"},[a("van-button",{attrs:{type:"default"}},[t._v("取消")]),a("van-button",{attrs:{type:"default"}},[t._v("确定")])],1)])]),a("van-overlay",{attrs:{show:t.overlay}},[a("div",{staticClass:"overlay"},[a("van-loading")],1)])],2)],1)},s=[],r=a("b00a"),n=a("8f8b"),o={name:"newcombo",data(){return{weekString:["周一","周二","周三","周四","周五","周六","周日"],week:[{label:"周一",id:"mon",index:1},{label:"周二",id:"tues",index:2},{label:"周三",id:"wed",index:3},{label:"周四",id:"thur",index:4},{label:"周五",id:"fri",index:5},{label:"周六",id:"sat",index:6},{label:"周日",id:"sun",index:7}],overlay:!1,conti:!1,pkname:"优选套餐",show:!1,actual_price:"",intercept:!0,upChecked:!0,listArr:[{name:"",count:"",original_price:0}],listImg:a("060a"),addImg:a("0a9c")}},components:{ContentLoad:r["a"]},watch:{},created(){this.initData()},activated(){this.intercept=!0,"string"===typeof this.isAdd&&"false"===this.isAdd||"boolean"===typeof this.isAdd&&!this.isAdd||this.setDetail()},beforeRouteLeave(t,e,a){this.conti=!1;let i=this;function s(t,e){"confirm"===t?(setTimeout(e,200),i.save(),this.conti&&a()):(e(),a(),i.$router.push({path:"/roomPackage"}))}"newcombo"===e.name&&"comboDetail"===t.name?(a(!1),this.$dialog.confirm({title:"提示",message:"是否保存修改的信息",beforeClose:s})):"roomPackage"===t.name&&"newcombo"===e.name&&!this._isAdd&&this.intercept?(a(!1),this.conti=!0,this.$dialog.confirm({title:"提示",message:"是否保存修改的信息",beforeClose:s})):a()},beforeRouteEnter(t,e,a){if("comboDetail"===e.name)return a(t=>{t.clearData(),t.setData()}),void a();"roomPackage"!==e.name||a(t=>{t.clearData()})},computed:{comboItem(){return this.$store.state.combo.comboItem},timeStr(){let t=[];if(this.comboItem){this.comboItem.period_weekdays.forEach(e=>{this.week.forEach(a=>{a.id===e&&t.push(a.label)})}),t.sort((t,e)=>{var a=this.weekString.indexOf(t),i=this.weekString.indexOf(e);return a-i});let e=t.join("，");return e+" "+this.changeTime(this.comboItem.period_time_start)+" - "+this.changeTime(this.comboItem.period_time_end)}return""},total(){let t=0;for(let e=0;e<this.listArr.length;e++){const a=this.listArr[e];t+=Number(a.count)*Number(a.original_price||0)}return t.toFixed(2)},isAdd(){return this.$route.query.c},_isAdd(){return"string"===typeof this.isAdd&&"false"===this.isAdd||"boolean"===typeof this.isAdd&&!this.isAdd}},methods:{setDetail(){this.getDetail=()=>new Promise(t=>{t({})})},getComboDetailData(){},setData(){this.getDetail()},getDetail(){return this.overlay=!0,new Promise((t,e)=>{Object(n["c"])(this.$store.state.user.ktv_id,this.$store.state.combo.comboItem.id).then(e=>{if(e.status<400){this.overlay=!1;let a=e.data;if(this.pkname=a.name,this.upChecked=a.enabled,this.actual_price=a.actual_price,0===a.goods.length)return this.setFood(),void t(e);this.listArr=a.goods}t(e)}).catch(t=>{e(t)})})},clearData(){this.pkname="优选套餐",this.listArr=[{name:"",count:"",original_price:0}],this.actual_price="",this.upChecked=!0},adder(){this.$store.commit("set_comboItem",null),this.clearData()},editer(){this.clearData(),this.setData()},setFood(){this.listArr=[{name:"",count:"",original_price:0}]},initData(){"string"===typeof this.isAdd&&"false"===this.isAdd||"boolean"===typeof this.isAdd&&!this.isAdd?this.editer():(this.setDetail(),this.adder())},modiComboItem(){this.overlay=!0;let t=this.listArr.filter(t=>(t.original_price=parseFloat(t.original_price),t));Object(n["g"])({ktv_id:this.$store.state.user.ktv_id,pk:this.comboItem.id},{name:this.pkname,goods:this.listArr[0].name?t:[],period_weekdays:this.comboItem.period_weekdays,period_time_start:this.comboItem.period_time_start,period_time_end:this.comboItem.period_time_end,enabled:this.upChecked,actual_price:this.actual_price}).then(t=>{t&&(this.$toast({message:"套餐修改成功",type:"success"}),this.$router.push({name:"roomPackage"}))})},addCombo(){this.overlay=!0;let t=this.listArr.filter((function(t){return t.original_price=parseFloat(t.original_price),t})),e={name:this.pkname,goods:this.listArr[0].name?t:[],period_weekdays:this.comboItem.period_weekdays,period_time_start:this.comboItem.period_time_start,period_time_end:this.comboItem.period_time_end,enabled:this.upChecked,actual_price:this.actual_price};Object(n["a"])(this.$store.state.user.ktv_id,e).then(t=>{this.overlay=!1,(200===t.status||t.status<400)&&(this.$toast({message:"套餐新增成功",type:"success"}),this.intercept=!1,this.$router.push({name:"roomPackage"}))})},actual_priceFormat(t){if(!t.target.value)return void(this.actual_price="");let e=0;"number"===typeof Number(t.target.value)&&(e=Number(t.target.value).toFixed(2)),this.actual_price=e},formatter(t,e){let a=0;"0"!==t.target.value.substring(0,1)&&0!==Number(t.target.value)?(a="number"===typeof Number(t.target.value)?Number(t.target.value).toFixed(2):0,this.listArr[e].original_price=a):this.listArr[e].original_price=0},onCancel(){this.show=!1},del(t){this.listArr.splice(t,1)},changeTime(t){let e="",a="",i=Math.floor(t/60),s=Math.floor(t%60);if(a=s<10?`0${s}`:s,i<10)e=`0${i}`;else{if(24==i)return`次日 00: ${a}`;if(i>24)return`次日 ${i-24}: ${a}`}return`${e}:${a}`},generationObj(){return{name:"",count:"",original_price:""}},add(){this.listArr.push(this.generationObj())},save(){this.conti=!1;let t=!0;if(this.pkname){if(this.listArr.length>1){for(let e=0;e<this.listArr.length;e++){const a=this.listArr[e];if(!a.name||!a.count||!a.original_price){this.toast("商品信息请输入完整"),t=!1;break}}if(!t)return}if(1===this.listArr.length){let t=this.listArr[0];if(t.name&&!t.count||t.name&&!t.original_price||t.count&&!t.name||t.count&&!t.original_price||t.original_price&&!t.name||t.original_price&&!t.count)return void this.toast("商品信息请输入完整")}""!==this.actual_price?0!=this.actual_price?this.timeStr?(this.conti=!0,this._isAdd?this.modiComboItem():this.addCombo()):this.toast("请选择可用时段"):this.toast("套餐优惠价不可为0"):this.toast("请输入套餐优惠价")}else this.toast("套餐名称不可为空")},toast(t){this.$toast.fail({duration:2500,forbidClick:!0,overlay:!0,className:"loadClass",message:t})}}},l=o,c=(a("1b12"),a("8279"),a("2877")),u=Object(c["a"])(l,i,s,!1,null,"dd34baec",null);e["default"]=u.exports},"308c":function(t,e,a){},"36fd":function(t,e,a){"use strict";var i=a("5443"),s=a.n(i);s.a},"3a97":function(t,e,a){},"431c":function(t,e,a){"use strict";var i=a("3a97"),s=a.n(i);s.a},5443:function(t,e,a){},"54a1":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-loading",{attrs:{color:t.color}})],1)},s=[],r={computed:{color(){return this.$store.state.app.theme.color}}},n=r,o=a("2877"),l=Object(o["a"])(n,i,s,!1,null,null,null);e["a"]=l.exports},8279:function(t,e,a){"use strict";var i=a("308c"),s=a.n(i);s.a},"885b":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"emptyComponentBox"},[a("img",{attrs:{src:t.imgsrc,alt:""}}),a("span",{staticStyle:{color:"#d0d0d0","font-size":"14px","margin-top":"10px",display:"block","margin-bottom":"20px"}},[t._v(" "+t._s(t.text)+" ")]),t.title&&""!=t.title?a("van-button",{staticClass:"buttonSquare",on:{click:t.btn}},[t._v(t._s(t.title))]):t._e()],1)},s=[],r={props:["text","title"],data(){return{imgsrc:a("1427")}},methods:{btn(){this.$emit("eventBtn")}}},n=r,o=(a("431c"),a("2877")),l=Object(o["a"])(n,i,s,!1,null,"4d207a0f",null);e["a"]=l.exports},"8f8b":function(t,e,a){"use strict";a.d(e,"d",(function(){return s})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return o})),a.d(e,"f",(function(){return l})),a.d(e,"g",(function(){return c})),a.d(e,"e",(function(){return u}));var i=a("66df");const s=t=>i["a"].request({url:`/ktv/pkg/ktvs/${t}/packages`,params:{is_delete:!1,ordering:"-weight"},method:"get"}),r=(t,e)=>i["a"].request({url:`/ktv/pkg/ktvs/${t}/packages/${e}`,params:{},method:"get"}),n=(t,e)=>i["a"].request({url:`/ktv/pkg/ktvs/${t}/packages`,data:e,method:"post"}),o=(t,e)=>i["a"].request({url:`/ktv/pkg/ktvs/${t}/packages/${e}`,method:"delete"}),l=(t,e)=>i["a"].request({url:`/ktv/pkg/ktvs/${t.ktv_id}/packages/${t.pk}`,method:"put",data:e}),c=(t,e)=>i["a"].request({url:`/ktv/pkg/ktvs/${t.ktv_id}/packages/${t.pk}`,method:"post",data:e}),u=(t,e)=>i["a"].request({url:`/ktv/pkg/ktvs/${t.ktv_id}/packages/batch_manage`,method:"put",data:{package_opts:e}})},ada9:function(t,e,a){"use strict";var i=a("e1d30"),s=a.n(i);s.a},ae9f:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"emptyComponentBox"},[a("img",{attrs:{src:t.imgsrc,alt:""}}),a("span",{staticStyle:{display:"flex","margin-top":"10px"}},[a("span",{staticStyle:{color:"#d0d0d0","font-size":"14px"}},[t._v(" "+t._s(t.text)+" ")]),a("span",{staticClass:"errorTheme",on:{click:t.btn}},[t._v("重新加载")])])])},s=[],r={props:{text:{type:String,default:"加载失败"}},data(){return{imgsrc:a("1fe8")}},methods:{btn(){this.$emit("eventBtn")}}},n=r,o=(a("ada9"),a("2877")),l=Object(o["a"])(n,i,s,!1,null,"f9f26e0c",null);e["a"]=l.exports},b00a:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contentLoad"},[a("span",{directives:[{name:"show",rawName:"v-show",value:0==t.pageStatues,expression:"pageStatues == 0"}],staticClass:"content"},[a("Loading")],1),1==t.pageStatues?a("span",[t._t("default")],2):t._e(),2==t.pageStatues?a("span",{staticClass:"content"},[t.$slots.empty?t._t("empty"):a("Empty",{attrs:{text:t.emptyText}})],2):t._e(),3==t.pageStatues?a("span",{staticClass:"content"},[t.$slots.error?t._t("error"):a("Error",{attrs:{text:"加载失败"},on:{eventBtn:t.getData}})],2):t._e()])},s=[],r=a("54a1"),n=a("ae9f"),o=a("885b"),l={components:{Loading:r["a"],Empty:o["a"],Error:n["a"]},props:{getInfo:{type:Function},emptyText:{type:String,default:"暂无信息"}},data(){return{pageStatues:0}},methods:{getData(){this.pageStatues=0,this.getInfo().then(t=>{this.pageStatues=""!=t?1:2}).catch(t=>{console.log(t,"ppppp"),this.pageStatues=3})}},mounted(){this.getData()}},c=l,u=(a("36fd"),a("2877")),d=Object(u["a"])(c,i,s,!1,null,"5ccc5f6f",null);e["a"]=d.exports},e1d30:function(t,e,a){},fc28:function(t,e,a){}}]);
//# sourceMappingURL=chunk-5bf95cd9.94bc46c0.js.map